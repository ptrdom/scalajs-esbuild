<!DOCTYPE html>
<html>
<head>
    <!-- TODO Replace with hashed outputs in production build (Vite-like behaviour) -->
    <script src="/main.js"></script>
    <link rel="stylesheet" href="/main.css">

    <!-- TODO Inject with esbuild -->
    <script type="text/javascript">
      // Based on https://esbuild.github.io/api/#live-reload
      new EventSource('/esbuild').addEventListener('change', e => {
        const { added, removed, updated } = JSON.parse(e.data)

        if (!added.length && !removed.length && updated.length === 1) {
          for (const link of document.getElementsByTagName("link")) {
            const url = new URL(link.href)

            if (url.host === location.host && url.pathname === updated[0]) {
              const next = link.cloneNode()
              next.href = updated[0] + '?' + Math.random().toString(36).slice(2)
              next.onload = () => link.remove()
              link.parentNode.insertBefore(next, link.nextSibling)
              return
            }
          }
        }

        location.reload()
      })
    </script>
</head>
<body>
</body>
</html>